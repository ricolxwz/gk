---
title: 数据库:关系模型
comments: true
---

关系模型(Relational Model)是一种逻辑模型(Logical Model), 逻辑模型是什么详见[这里](/数据库/数据模型/#两类数据模型).

## 历史

在1970年之前, 主要使用的逻辑模型是层次模型和网络模型. 层次模型中数据以树状结构组织, 类似于目录结构; 网络模型中数据以图结构组织, 类似于网状结构. 这两种模型都用于早期的数据库系统, 都依赖于底层的计算机硬件结构, 查询和数据操作往往要有深厚的硬件和技术背景, 因此较为复杂, 难以使用.

1970年, IBM的E.F.Codd博士在ACM杂志上发表了论文*A Relation Model for Large Shared Data Banks*, 首次提出了关系模型的概念. 这篇文章触发了数据库管理方面的巨大变革, 他也因此获得了1981年的图灵奖.

## 关系模型

### 关系的概念

关系是一张二维命名的表格. 这个表格由行(又称为元组或记录)和列(又称为属性或字段)组成. 

并非是所有的表格都是关系, 关系需要满足下列条件:

- 关系必须有一个唯一的名字
- 关系中的属性名必须有一个唯一的名字, 列的顺序是不重要的
- 关系中所有的元组必须有相同的结构 
- 所有的属性都是原子类型的, 即每列中的数据是不可再分的基本单位, 如一个人的姓名应该分为"名"和"姓"两个独立的列, 而不是放在一个列中, 这个就是"第一范式"
- 一个关系是元组的集合, 所以每行必须是唯一的, 即不能有两行的所有属性值都相同; 行的顺序是不重要的

???+ tip Tip

    关系型数据库管理系统(RDBMS)在实现关系模型时对数学上的"关系"进行了修改, 具体包括:

    - RDBMS允许重复的行: 在纯粹的数学关系中, 所有的元组(即行)都应该是唯一的, 但在RDBMS中, 允许表格中存在重复的行
    - RDMBS支持对元组和属性进行排序: 数学熵的关系是无序的, 但是在RDBMS中, 元组(行)和属性(列)可以进行排序, 以便更有效地查询和操作数据
    - RDMBS允许用`null`表示缺失/不相关: 数学关系中每个属性应该有一个确切的值, 但是在RDBMS里面, 可以使用`null`值来表示缺失/不相关的信息

        ???+ example "例子"

            - 缺失: 新学生还没有选课
            - 不相关: 兼职教授的年收入是不相关的, 不是正式编制没有年收入
        
        使用`null`的优势是用一个特殊的值表示缺失/不相关可能在某些情景下不好用.

        ???+ example "例子"

            例如, 将工资设置为`-1`表示工资未知. 此时, 计算工资的平均值, 结果就是错误的.

        缺点就是我们必须先忽略所有的`null`, 比较麻烦.

## 使用SQL管理RDBMS

### 创建表

创建表的语法为:

```
CREATE TABLE <table_name> (<column_name> <column_type>, ...)
```

支持的类型有:

| 基本数据类型            | 描述                                                | 示例值                                               |
|-------------------------|-----------------------------------------------------|------------------------------------------------------|
| `SMALLINT` (2 字节)      | 整数值                                              | `1704`, `4070`                                        |
| `INTEGER` (4 字节)       | 整数值                                              | `1704`, `4070`                                        |
| `BIGINT` (8 字节)        | 整数值                                              | `1704`, `4070`                                        |
| `DECIMAL(p,q)`           | 固定精度的数值, 具有 `p` 位精度和 `q` 位小数        | `1003.44`, `160139.9`                                 |
| `NUMERIC(p,q)`           | 固定精度的数值, 具有 `p` 位精度和 `q` 位小数        | `1003.44`, `160139.9`                                 |
| `FLOAT(p)`               | 浮点数, 具有 `p` 位精度                             | `1.5E-4`, `10E20`                                     |
| `REAL`                   | 浮点数                                              | `1.5E-4`, `10E20`                                     |
| `DOUBLE PRECISION`       | 浮点数                                              | `1.5E-4`, `10E20`                                     |
| `CHAR(q)`                | 固定长度为 `q` 的字母数字字符串                     | `'The quick brown fix jumps...'`, `'INFO2120'`        |
| `VARCHAR(q)`             | 可变长度, 长度最多为 `q` 的字母数字字符串           | `'The quick brown fix jumps...'`, `'INFO2120'`        |
| `CLOB(q)`                | 可变长度的字母数字字符串                            | `'The quick brown fix jumps...'`, `'INFO2120'`        |
| `BLOB(r)`                | 大小为 `r` 的二进制字符串                           | `B’01101’`, `X’9E’`                                   |
| `DATE`                   | 日期                                                | `DATE ’1997-06-19’`, `DATE ’2001-08-23’`              |
| `TIME`                   | 时间                                                | `TIME ’20:30:45’`, `TIME ’00:15:30’`                  |
| `TIMESTAMP`              | 时间戳                                              | `TIMESTAMP ’2002-08-23 14:15:00’`                     |
| `INTERVAL`               | 时间间隔                                            | `INTERVAL ’11:15’ HOUR TO MINUTE`                     |

???+ example "例子"

    创建三张表格:

    ```sql
    CREATE TABLE Student (
    sid INTEGER,
    name VARCHAR(20)
    );
    CREATE TABLE Enrolled (
    sid INTEGER, ucode CHAR(8), semester VARCHAR(10)
    );
    CREATE TABLE UnitOfStudy (
    ucode CHAR(8),
    title VARCHAR(30),
    credit_pts INTEGER
    );
    ```

    得到的表格如[图](https://img.ricolxwz.io/2024/08/e7bd17ea2a47fbe0c29af21a62050751.png).

### 删除表

删除表的语法为:

```
DROP TABLE <table_name>
```

### 修改表

支持对表格做出很多修改, 比如说修改属性名, 增加列, 具体见DBMS提供商的表格. 

修改属性名:

```
ALTER TABLE <table_name> RENAME COLUMN <original_column_name> TO <new_column_name>
```

增加列:

```
ALTER TABLE <table_name> ADD COLUMN <column_name> <column_type>
```

### 插入元组

插入元组的语法为:

```
INSERT INTO <table_name> (<list_of_columns>) VALUES (<list_of_expressions>)
```

???+ example "例子"

    ```sql
    INSERT INTO Student VALUES (12345678, ‘Smith’);
    INSERT INTO Student (name, sid) VALUES (‘Smith’, 12345678);
    ```

### 更新元组

更新元组的语法为:

```
UPDATE <table_name> SET <column_name>=<value>, ... WHERE <column_name>=<value>, ...
```

???+ example "例子"

    ```sql
    UPDATE Student
        SET address = ‘4711 Water Street’
        WHERE sid = 123456789;
    ```

### 删除元组

删除元组的语法为:

```
DELETE FROM <table_name> WHERE <column_name>=<value>, ...
```

???+ example "例子"

    ```sql
    DELETE FROM Student WHERE name="Smith";
    ```