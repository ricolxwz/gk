---
title: k8s:命令
comments: true
---

## deployment

### 使用`kubectl`命令

```
$ kubectl create deployment nginx-depl --image=nginx # 创建了一个只有一个nginx容器的pod, 并且只有一个副本. 这个命令会自动生成一个YAML配置文件
deployment.apps/nginx-depl created
$ kubectl get pod
NAME                          READY   STATUS              RESTARTS   AGE # 这里的7fb9f是replicaset下一个副本pod的id
nginx-depl-6777bffb6f-7fb9f   0/1     containercreating   0          0s
$ kubectl get replicaset # 这里的6777bffb6f是replicaset的id
name                    desired   current   ready   age
nginx-depl-6777bffb6f   1         1         0       0s
$ kubectl edit deployment nginx-depl # 可以修改YAML配置文件, 如果修改了, 就会产生另一个replicaset
$ kubectl logs nginx-depl-6777bffb6f-7fb9f 
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2024/09/15 23:35:47 [notice] 1#1: using the "epoll" event method
2024/09/15 23:35:47 [notice] 1#1: nginx/1.27.1
2024/09/15 23:35:47 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)
2024/09/15 23:35:47 [notice] 1#1: OS: Linux 6.10.7-orbstack-00280-gd3b7ec68d3d4
2024/09/15 23:35:47 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2024/09/15 23:35:47 [notice] 1#1: start worker processes
2024/09/15 23:35:47 [notice] 1#1: start worker process 29
2024/09/15 23:35:47 [notice] 1#1: start worker process 30
2024/09/15 23:35:47 [notice] 1#1: start worker process 31
2024/09/15 23:35:47 [notice] 1#1: start worker process 32
2024/09/15 23:35:47 [notice] 1#1: start worker process 33
2024/09/15 23:35:47 [notice] 1#1: start worker process 34
2024/09/15 23:35:47 [notice] 1#1: start worker process 35
2024/09/15 23:35:47 [notice] 1#1: start worker process 36
$ kubectl describe pod nginx-depl-6777bffb6f-7fb9f  
Name:             nginx-depl-6777bffb6f-7fb9f
Namespace:        default
Priority:         0
Service Account:  default
Node:             orbstack/198.19.249.2
Start Time:       Mon, 16 Sep 2024 09:35:32 +1000
Labels:           app=nginx-depl
                  pod-template-hash=6777bffb6f
Annotations:      <none>
Status:           Running
IP:               192.168.194.10
IPs:
  IP:           192.168.194.10
  IP:           fd07:b51a:cc66:a::a
Controlled By:  ReplicaSet/nginx-depl-6777bffb6f
Containers:
  nginx:
    Container ID:   docker://8cbf8e6aa3abbf58553295f0c03ce534c58ab52590571a3cbac94d960cd04047
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:04ba374043ccd2fc5c593885c0eacddebabd5ca375f9323666f28dfd5a9710e3
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Mon, 16 Sep 2024 09:35:47 +1000
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-2jgsl (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  kube-api-access-2jgsl:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  10m   default-scheduler  Successfully assigned default/nginx-depl-6777bffb6f-7fb9f to orbstack
  Normal  Pulling    10m   kubelet            Pulling image "nginx"
  Normal  Pulled     10m   kubelet            Successfully pulled image "nginx" in 13.729s (13.729s including waiting)
  Normal  Created    10m   kubelet            Created container nginx
  Normal  Started    10m   kubelet            Started container nginx
$ kubectl exec -it nginx-depl-6777bffb6f-7fb9f -- /bin/bash
$ kubectl get deployment
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
nginx-depl   1/1     1            1           13m
$ kubectl delete deployment nginx-depl # 删除掉所有的replicaset和所有的对应pod
```

### 使用YAML配置文件

